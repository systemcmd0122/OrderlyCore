<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Overseer - Admin Login</title>
    <link rel="stylesheet" href="/admin.css">
    <link href="https://fonts.googleapis.com/css2?family=Share+Tech+Mono&family=Noto+Sans+JP:wght@300;400;700&display=swap" rel="stylesheet">
    <script src="https://unpkg.com/feather-icons"></script>
</head>
<body class="login-page-body">

    <div class="login-container">
        <div class="terminal-window" id="login-terminal">
            <div class="terminal-header">
                <div class="header-dots">
                    <span class="dot red"></span>
                    <span class="dot yellow"></span>
                    <span class="dot green"></span>
                </div>
                <div class="header-title">overseer-auth-system --root</div>
            </div>
            <div class="terminal-body">
                <div id="terminal-output">
                    <div class="line">Initializing secure connection... <span class="text-success">OK</span></div>
                    <div class="line">Awaiting administrator credentials...</div>
                </div>
                <form id="login-form" class="login-form">
                    <div class="line prompt-line">
                        <span class="prompt">root@overseer:~#</span>
                        <div class="input-container">
                            <i data-feather="key" class="input-icon"></i>
                            <input type="password" id="password" name="password" required placeholder="Enter Admin Password..." autocomplete="current-password" class="terminal-input">
                            <span class="caret"></span>
                        </div>
                    </div>
                    <button type="submit" class="hidden-submit"></button>
                </form>
                <div id="message-container" class="line"></div>
            </div>
        </div>
         <a href="/" class="back-to-home">
            <i data-feather="home"></i>
            <span>ホームページに戻る</span>
        </a>
    </div>

    <script>
        document.addEventListener('DOMContentLoaded', () => {
            feather.replace();

            const form = document.getElementById('login-form');
            const passwordInput = document.getElementById('password');
            const messageContainer = document.getElementById('message-container');
            const terminalOutput = document.getElementById('terminal-output');
            const loginTerminal = document.getElementById('login-terminal');

            // Focus on input when terminal is clicked
            loginTerminal.addEventListener('click', () => {
                passwordInput.focus();
            });

            form.addEventListener('submit', async (e) => {
                e.preventDefault();
                const password = passwordInput.value;

                if (!password) {
                    showMessage('ERROR: Password cannot be empty.', 'error');
                    return;
                }
                
                passwordInput.disabled = true;
                showMessage('Authenticating... Please wait.', 'loading');

                try {
                    const response = await fetch('/api/admin/login', {
                        method: 'POST',
                        headers: { 'Content-Type': 'application/json' },
                        body: JSON.stringify({ password })
                    });

                    const data = await response.json();

                    if (response.ok) {
                        showMessage(`ACCESS GRANTED. Welcome, admin. Redirecting to secure panel...`, 'success');
                        setTimeout(() => {
                             window.location.href = '/admin.html';
                        }, 2000);
                    } else {
                        throw new Error(data.error || 'Authentication failed');
                    }
                } catch (error) {
                    showMessage(`ACCESS DENIED: ${error.message}`, 'error');
                    passwordInput.disabled = false;
                    passwordInput.value = '';
                    passwordInput.focus();
                }
            });

            const showMessage = (text, type) => {
                const line = document.createElement('div');
                line.className = `line text-${type}`;
                line.textContent = text;
                messageContainer.innerHTML = ''; // Clear previous message
                messageContainer.appendChild(line);
            };
        });
    </script>
</body>
</html>